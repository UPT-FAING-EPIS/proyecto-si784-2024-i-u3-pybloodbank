<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\UPT Sistemas 7Â°\calidad y pruebas software\Pruebas finales\FINAL\ProyectoU2 Version 9\ProyectoFinal\TestGestiondePersonal.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using NUnit.Framework;
using System;
using System.Data;
using System.Data.SqlClient;

namespace Proyecto_Final_Blood_Bank.Tests
{
    [TestFixture]
    internal class TestGestiondePersonal
    {
        private PERSONAL form;

        [SetUp]
        public void SetUp()
        {
            // Configurar el formulario y el contexto de la prueba
            form = new PERSONAL();
            form.Show(); // Mostrar el formulario para pruebas
        }

        [Test]
        public void TestCargarGrilla()
        {
            // Llamar al m&#233;todo que carga la grilla
            form.CargarGrilla();

            // Verificar que el DataGridView se haya llenado con datos
            DataTable dt = form.dgvPersonal.DataSource as DataTable;
            Assert.That(dt.Rows.Count &gt; 0, &quot;El DataGridView no contiene datos.&quot;);
        }

        [Test]
        public void TestLabel3Click()
        {
            // Simular la acci&#243;n de clic en label3 y verificar el resultado
            form.lblUsuario.Text = &quot;existingUser&quot;; // Simula un usuario v&#225;lido
            form.label3_Click(null, EventArgs.Empty);

            // Aqu&#237; puedes agregar verificaciones para asegurar que se abri&#243; el formulario correcto
            // Dependiendo de la implementaci&#243;n, podr&#237;as necesitar verificar el estado del formulario
        }

        [Test]
        public void TestButton1Click_SubirEstado()
        {
            // Simular el texto de usuario y ejecutar el evento click del bot&#243;n Subir
            form.txtUsuario.Text = &quot;testUser&quot;;
            form.cmbEstado.SelectedIndex = 1; // Simula selecci&#243;n de estado P

            form.button1_Click(null, EventArgs.Empty);

            // Verificar que el estado se haya actualizado correctamente en la base de datos
            string estadoObtenido = ObtenerEstadoUsuarioDesdeBD(&quot;testUser&quot;);
        }

        [Test]
        public void TestButtonBajarClick()
        {
            // Simular el texto de usuario y ejecutar el evento click del bot&#243;n Bajar
            form.txtUsuario.Text = &quot;testUser&quot;;
            form.cmbEstado.SelectedIndex = 0; // Simula selecci&#243;n de estado N

            form.btnBajar_Click(null, EventArgs.Empty);

            // Verificar que el estado se haya actualizado correctamente en la base de datos
            string estadoObtenido = ObtenerEstadoUsuarioDesdeBD(&quot;testUser&quot;);
        }

        private string ObtenerEstadoUsuarioDesdeBD(string usuario)
        {
            string estado = &quot;&quot;;

            // Consultar el estado actual del usuario en la base de datos
            string comando = &quot;SELECT estado FROM Personal WHERE Usuario = @usuario&quot;;
            using (SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;))
            {
                con.Open();
                using (SqlCommand cmd = new SqlCommand(comando, con))
                {
                    cmd.Parameters.AddWithValue(&quot;@usuario&quot;, usuario);
                    using (SqlDataReader datos = cmd.ExecuteReader())
                    {
                        if (datos.Read())
                        {
                            estado = datos[&quot;estado&quot;].ToString();
                        }
                    }
                }
            }

            return estado;
        }

        [TearDown]
        public void TearDown()
        {
            // Cerrar el formulario al finalizar las pruebas si no se ha cerrado
            if (form != null &amp;&amp; !form.IsDisposed)
            {
                form.Close();
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,1],[17,13,17,35,1],[18,13,18,25,1],[19,9,19,10,1],[23,9,23,10,1],[25,13,25,33,1],[28,13,28,69,1],[29,13,29,82,1],[30,9,30,10,1],[34,9,34,10,1],[36,13,36,51,1],[37,13,37,54,1],[41,9,41,10,1],[45,9,45,10,1],[47,13,47,47,1],[48,13,48,46,1],[50,13,50,55,1],[53,13,53,77,1],[54,9,54,10,1],[58,9,58,10,1],[60,13,60,47,1],[61,13,61,46,1],[63,13,63,56,1],[66,13,66,77,1],[67,9,67,10,1],[70,9,70,10,1],[71,13,71,32,1],[74,13,74,85,1],[75,20,75,132,1],[76,13,76,14,1],[77,17,77,28,1],[78,24,78,69,1],[79,17,79,18,1],[80,21,80,70,1],[81,28,81,69,1],[82,21,82,22,1],[83,25,83,42,1],[84,25,84,26,1],[85,29,85,65,1],[86,25,86,26,1],[87,21,87,22,1],[88,17,88,18,1],[89,13,89,14,1],[91,13,91,27,1],[92,9,92,10,1],[96,9,96,10,1],[98,13,98,50,1],[99,13,99,14,1],[100,17,100,30,1],[101,13,101,14,1],[102,9,102,10,1]]);
    </script>
  </body>
</html>