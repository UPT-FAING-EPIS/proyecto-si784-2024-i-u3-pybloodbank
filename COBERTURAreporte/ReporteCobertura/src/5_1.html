<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\UPT Sistemas 7Â°\calidad y pruebas software\Pruebas finales\FINAL\ProyectoU2 Version 9\ProyectoFinal\BANCO DE SANGRE.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Data.SqlClient;

namespace Proyecto_Final_Blood_Bank
{
	public partial class BANCO_DE_SANGRE : Form
	{
        public BANCO_DE_SANGRE()
		{
            InitializeComponent();
			lblVolver.MouseEnter += OnMouseEnter;
			lblVolver.MouseLeave += OnMouseLeave;
            Cambio1 = new Font(&quot;Nirmala UI&quot;, 12F, FontStyle.Bold | FontStyle.Underline, GraphicsUnit.Point, 0);
            Cambio2 = new Font(&quot;Nirmala UI&quot;, 9.75F, FontStyle.Bold | FontStyle.Underline, GraphicsUnit.Point, 0);
            this.FormClosed += new System.Windows.Forms.FormClosedEventHandler(this.Form_FormClosed);
		}
        private Font Cambio1;
        private Font Cambio2;
        private void Form_FormClosed(object sender, FormClosedEventArgs e)
		{
			Application.Exit();
		}

        private string connectionString = &quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;;

        public void CargarGrilla()
{
		using (SqlConnection con = new SqlConnection(connectionString))
		{
			string consulta = &quot;Select * from BancoDeSangre&quot;;
			SqlDataAdapter adaptador = new SqlDataAdapter(consulta, con);
			DataTable dt = new DataTable();
			adaptador.Fill(dt);
			dgvBancoSangre.DataSource = dt;
			dgvBancoSangre.Columns[0].Width = 45;
			dgvBancoSangre.Columns[1].Width = 45;
			dgvBancoSangre.Columns[2].Width = 45;
		}
	}

	public void CargarGrilla2()
{
		using (SqlConnection con = new SqlConnection(connectionString))
		{
			string consulta = &quot;select dni, nombre, apellido, tipo, rh from PACIENTES&quot;;
			SqlDataAdapter adaptador = new SqlDataAdapter(consulta, con);
			DataTable dt = new DataTable();
			adaptador.Fill(dt);
			dgvPacientes.DataSource = dt;
			dgvPacientes.Columns[3].Width = 45;
			dgvPacientes.Columns[4].Width = 45;
		}
	}






		public void label3_Click(object sender, EventArgs e)
		{
			string temp_usuario = lblUsuario.Text;
			string comando = &quot;SELECT estado FROM Personal WHERE Usuario=@usuario&quot;;
			using (SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;))
			{
				con.Open();
				using (SqlCommand cmd = new SqlCommand(comando, con))
				{
					cmd.Parameters.AddWithValue(&quot;@usuario&quot;, temp_usuario);
					cmd.ExecuteNonQuery();

					SqlDataReader datos;
					datos = cmd.ExecuteReader();
					if (datos.Read())
					{
						string estado = datos[&quot;estado&quot;].ToString();
						switch (estado)
						{
							case &quot;N&quot;:
								new OPCIONES_1().Show();
								this.Hide();
								break;
							case &quot;P&quot;:
								new OPCIONES_2().Show();
								this.Hide();
								break;
							case &quot;A&quot;:
								new OPCIONES().Show();
								this.Hide();
								break;
							default:
								// Handle any other cases or errors here
								break;
						}
					}
				}
			}
		}
		public void OnMouseEnter(object sender, EventArgs e)
		{
			lblVolver.Font = Cambio1;
        }

		public void OnMouseLeave(object sender, EventArgs e)
		{
			lblVolver.Font = Cambio2;

        }

		public void button1_Click(object sender, EventArgs e)
		{
			try
			{
				// Establecer la conexi&#243;n a la base de datos
				using (SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;))
				{
					con.Open();

					// Consulta SQL parametrizada
					string consulta = &quot;SELECT dni, nombre, apellido, tipo, rh FROM Pacientes WHERE dni LIKE @buscar OR nombre LIKE @buscar&quot;;

					// Crear el adaptador de datos con consulta parametrizada
					SqlDataAdapter adaptador = new SqlDataAdapter(consulta, con);

					// A&#241;adir par&#225;metros
					adaptador.SelectCommand.Parameters.AddWithValue(&quot;@buscar&quot;, &quot;%&quot; + txtBuscar.Text + &quot;%&quot;);

					// Llenar DataTable con los resultados de la consulta
					DataTable dt = new DataTable();
					adaptador.Fill(dt);

					// Asignar el DataTable como fuente de datos del DataGridView
					dgvPacientes.DataSource = dt;

					// Ajustar anchos de columnas
					dgvPacientes.Columns[3].Width = 45;
					dgvPacientes.Columns[4].Width = 45;
				}
			}
			catch (Exception ex)
			{
				MessageBox.Show(&quot;Error al buscar pacientes: &quot; + ex.Message, &quot;Error&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
		}


		private Rectangle RecTitulo;
		private Rectangle RecVolver;
        private Rectangle RecUsuario;
		private Rectangle ReclblNombre;
		private Rectangle RectxtNombre;
		private Rectangle RecBuscar;
		private Rectangle RecGrillaPacientes;
		private Rectangle RecGrillaStock;

		private Size formOriginalSize;

		public void BANCO_DE_SANGRE_Load(object sender, EventArgs e)
		{
			lblUsuario.Text = LOGIN.NombreUsuario;
			CargarGrilla();
			CargarGrilla2();

			formOriginalSize = this.Size;
			RecTitulo = new Rectangle(lblTitulo.Location.X, lblTitulo.Location.Y, lblTitulo.Width, lblTitulo.Height);
			RecVolver = new Rectangle(lblVolver.Location.X, lblVolver.Location.Y, lblVolver.Width, lblVolver.Height);
			RecUsuario = new Rectangle(lblUsuario.Location.X, lblUsuario.Location.Y, lblUsuario.Width, lblUsuario.Height);
			ReclblNombre = new Rectangle(lblNombre.Location.X, lblNombre.Location.Y, lblNombre.Width, lblNombre.Height);
			RectxtNombre = new Rectangle(txtBuscar.Location.X, txtBuscar.Location.Y, txtBuscar.Width, txtBuscar.Height);
			RecBuscar = new Rectangle(btnBuscar.Location.X, btnBuscar.Location.Y, btnBuscar.Width, btnBuscar.Height);
			RecGrillaPacientes = new Rectangle(dgvPacientes.Location.X, dgvPacientes.Location.Y, dgvPacientes.Width, dgvPacientes.Height);
			RecGrillaStock = new Rectangle(dgvBancoSangre.Location.X, dgvBancoSangre.Location.Y, dgvBancoSangre.Width, dgvBancoSangre.Height);

		}

		private void resizeControl(Rectangle OriginalControlRect, Control control)
		{
			float xRatio = (float)(this.Width) / (float)(formOriginalSize.Width);
			float yRatio = (float)(this.Height) / (float)(formOriginalSize.Height);


			int newX = (int)(OriginalControlRect.X * xRatio);
			int newY = (int)(OriginalControlRect.Y * yRatio);

			int newWidth = (int)(OriginalControlRect.Width * xRatio);
			int newHeight = (int)(OriginalControlRect.Height * yRatio);

			control.Location = new Point(newX, newY);
			control.Size = new Size(newWidth, newHeight);

		}

		public void BANCO_DE_SANGRE_Resize(object sender, EventArgs e)
		{
			resizeControl(RecTitulo, lblTitulo);
			resizeControl(RecVolver, lblVolver);
			resizeControl(RecUsuario, lblUsuario);
			resizeControl(ReclblNombre, lblNombre);
			resizeControl(RectxtNombre, txtBuscar);
			resizeControl(RecBuscar, btnBuscar);
			resizeControl(RecGrillaPacientes, dgvPacientes);
			resizeControl(RecGrillaStock, dgvBancoSangre);


		}

        private void dgvBancoSangre_CellFormatting(object sender, DataGridViewCellFormattingEventArgs e)
        {
            if (e.ColumnIndex == 2 &amp;&amp; Convert.ToDouble(e.Value) &lt;= 10)
            {
                e.CellStyle.ForeColor = Color.Red;
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[16,9,16,33,1],[17,3,17,4,1],[18,13,18,35,1],[19,4,19,41,1],[20,4,20,41,1],[21,13,21,112,1],[22,13,22,114,1],[23,13,23,102,1],[24,3,24,4,1],[28,3,28,4,1],[29,4,29,23,1],[30,3,30,4,1],[32,9,32,117,1],[35,1,35,2,1],[36,10,36,65,1],[37,3,37,4,1],[38,4,38,52,1],[39,4,39,65,1],[40,4,40,35,1],[41,4,41,23,1],[42,4,42,35,1],[43,4,43,41,1],[44,4,44,41,1],[45,4,45,41,1],[46,3,46,4,1],[47,2,47,3,1],[50,1,50,2,1],[51,10,51,65,1],[52,3,52,4,1],[53,4,53,78,1],[54,4,54,65,1],[55,4,55,35,1],[56,4,56,23,1],[57,4,57,33,1],[58,4,58,39,1],[59,4,59,39,1],[60,3,60,4,1],[61,2,61,3,1],[69,3,69,4,1],[70,4,70,42,1],[71,4,71,74,1],[72,11,72,123,1],[73,4,73,5,1],[74,5,74,16,1],[75,12,75,57,1],[76,5,76,6,1],[77,6,77,60,1],[78,6,78,28,1],[81,6,81,34,1],[82,6,82,23,1],[83,6,83,7,0],[84,7,84,50,0],[85,7,85,22,0],[88,9,88,33,0],[89,9,89,21,0],[90,9,90,15,0],[92,9,92,33,0],[93,9,93,21,0],[94,9,94,15,0],[96,9,96,31,0],[97,9,97,21,0],[98,9,98,15,0],[101,9,101,15,0],[103,6,103,7,0],[104,5,104,6,1],[105,4,105,5,1],[106,3,106,4,1],[108,3,108,4,1],[109,4,109,29,1],[110,9,110,10,1],[113,3,113,4,1],[114,4,114,29,1],[116,9,116,10,1],[119,3,119,4,1],[121,4,121,5,1],[123,12,123,124,1],[124,5,124,6,1],[125,6,125,17,1],[128,6,128,126,1],[131,6,131,67,1],[134,6,134,93,1],[137,6,137,37,1],[138,6,138,25,1],[141,6,141,35,1],[144,6,144,41,1],[145,6,145,41,1],[146,5,146,6,1],[147,4,147,5,1],[148,4,148,24,0],[149,4,149,5,0],[150,5,150,118,0],[151,4,151,5,0],[152,3,152,4,1],[167,3,167,4,1],[168,4,168,42,1],[169,4,169,19,1],[170,4,170,20,1],[172,4,172,33,1],[173,4,173,109,1],[174,4,174,109,1],[175,4,175,114,1],[176,4,176,112,1],[177,4,177,112,1],[178,4,178,109,1],[179,4,179,130,1],[180,4,180,134,1],[182,3,182,4,1],[185,3,185,4,1],[186,4,186,73,1],[187,4,187,75,1],[190,4,190,53,1],[191,4,191,53,1],[193,4,193,61,1],[194,4,194,63,1],[196,4,196,45,1],[197,4,197,49,1],[199,3,199,4,1],[202,3,202,4,1],[203,4,203,40,1],[204,4,204,40,1],[205,4,205,42,1],[206,4,206,43,1],[207,4,207,43,1],[208,4,208,40,1],[209,4,209,52,1],[210,4,210,50,1],[213,3,213,4,1],[216,9,216,10,1],[217,13,217,71,1],[218,13,218,14,1],[219,17,219,51,1],[220,13,220,14,1],[221,9,221,10,1]]);
    </script>
  </body>
</html>