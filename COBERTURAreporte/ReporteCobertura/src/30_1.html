<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\UPT Sistemas 7Â°\calidad y pruebas software\Pruebas finales\FINAL\ProyectoU2 Version 9\ProyectoFinal\TestRegistroDonante.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Moq;
using NUnit.Framework;
using System.Windows.Forms;
using System.Reflection;

namespace Proyecto_Final_Blood_Bank
{
    internal class RdonanteTEST
    {
        private Mock&lt;IDbConnection&gt; mockConnection;
        private Mock&lt;IDbCommand&gt; mockCommand;
        private Mock&lt;IDataReader&gt; mockReader;
        private RegistroDonantes form;

        [SetUp]
        public void Setup()
        {
            mockConnection = new Mock&lt;IDbConnection&gt;();
            mockCommand = new Mock&lt;IDbCommand&gt;();
            mockReader = new Mock&lt;IDataReader&gt;();

            mockConnection.Setup(conn =&gt; conn.CreateCommand()).Returns(mockCommand.Object);
            mockCommand.Setup(cmd =&gt; cmd.ExecuteReader()).Returns(mockReader.Object);

            form = new RegistroDonantes();
        }

        [Test]
        public void CargarGrilla_ShouldLoadDataIntoGrid()
        {
            // Arrange
            var dataTable = new DataTable();
            dataTable.Rows.Add(dataTable.NewRow());
            mockCommand.Setup(c =&gt; c.ExecuteReader()).Returns(mockReader.Object);
            mockReader.Setup(r =&gt; r.Read()).Returns(true);

            // Act
            form.GetType().GetMethod(&quot;CargarGrilla&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, null);
        }

        [Test]
        public void Limpiar_ShouldClearFields()
        {
            // Arrange
            var txtApellido = form.Controls[&quot;txtApellido&quot;] as TextBox;
            var txtDni = form.Controls[&quot;txtDni&quot;] as TextBox;
            var txtNombre = form.Controls[&quot;txtNombre&quot;] as TextBox;
            var rbNo = form.Controls[&quot;rbNo&quot;] as RadioButton;
            var rbSi = form.Controls[&quot;rbSi&quot;] as RadioButton;
            var cmbRH = form.Controls[&quot;cmbRH&quot;] as ComboBox;
            var cmbTipoDeSangre = form.Controls[&quot;cmbTipoDeSangre&quot;] as ComboBox;

            txtApellido.Text = &quot;Test&quot;;
            txtDni.Text = &quot;12345678&quot;;
            txtNombre.Text = &quot;Test&quot;;
            rbNo.Checked = true;
            rbSi.Checked = true;
            cmbRH.SelectedIndex = 0;
            cmbTipoDeSangre.SelectedIndex = 0;

            // Act
            form.GetType().GetMethod(&quot;Limpiar&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, null);

            // Assert
            Assert.Multiple(() =&gt;
            {
                Assert.That(txtApellido.Text, Is.EqualTo(string.Empty));
                Assert.That(txtDni.Text, Is.EqualTo(string.Empty));
                Assert.That(txtNombre.Text, Is.EqualTo(string.Empty));
                Assert.That(rbNo.Checked, Is.False);
                Assert.That(rbSi.Checked, Is.False);
                Assert.That(cmbRH.SelectedIndex, Is.EqualTo(-1));
                Assert.That(cmbTipoDeSangre.SelectedIndex, Is.EqualTo(-1));
            });
        }

        [Test]
        public void ValidarDni_ShouldReturnTrue_WhenDniIsValid()
        {
            // Arrange
            string validDni = &quot;12345678&quot;;

            // Act
            var result = (bool)form.GetType().GetMethod(&quot;ValidarDni&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, new object[] { validDni });

            // Assert
            Assert.That(result, Is.True);
        }

        [Test]
        public void ValidarDni_ShouldReturnFalse_WhenDniIsInvalid()
        {
            // Arrange
            string invalidDni = &quot;1234567&quot;;

            // Act
            var result = (bool)form.GetType().GetMethod(&quot;ValidarDni&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, new object[] { invalidDni });

            // Assert
            Assert.That(result, Is.False);
        }

        [Test]
        public void DonanteExiste_ShouldReturnTrue_WhenDonanteExists()
        {
            // Arrange
            string dni = &quot;12345678&quot;;
            mockCommand.Setup(c =&gt; c.ExecuteScalar()).Returns(1);
            mockConnection.Setup(c =&gt; c.CreateCommand()).Returns(mockCommand.Object);

            // Act
            var result = (bool)form.GetType().GetMethod(&quot;DonanteExiste&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, new object[] { dni });
        }

        [Test]
        public void DonanteExiste_ShouldReturnFalse_WhenDonanteDoesNotExist()
        {
            // Arrange
            string dni = &quot;12345678&quot;;
            mockCommand.Setup(c =&gt; c.ExecuteScalar()).Returns(0);
            mockConnection.Setup(c =&gt; c.CreateCommand()).Returns(mockCommand.Object);

            // Act
            var result = (bool)form.GetType().GetMethod(&quot;DonanteExiste&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, new object[] { dni });
        }

        [Test]
        public void ValidarCampos_ShouldReturnTrue_WhenAllFieldsAreValid()
        {
            // Arrange
            var txtDni = form.Controls[&quot;txtDni&quot;] as TextBox;
            var txtNombre = form.Controls[&quot;txtNombre&quot;] as TextBox;
            var txtApellido = form.Controls[&quot;txtApellido&quot;] as TextBox;
            var cmbTipoDeSangre = form.Controls[&quot;cmbTipoDeSangre&quot;] as ComboBox;
            var cmbRH = form.Controls[&quot;cmbRH&quot;] as ComboBox;
            var rbNo = form.Controls[&quot;rbNo&quot;] as RadioButton;

            txtDni.Text = &quot;12345678&quot;;
            txtNombre.Text = &quot;Test&quot;;
            txtApellido.Text = &quot;Test&quot;;
            cmbTipoDeSangre.SelectedIndex = 0;
            cmbRH.SelectedIndex = 0;
            rbNo.Checked = true;

            // Act
            var result = (bool)form.GetType().GetMethod(&quot;ValidarCampos&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, null);

            // Assert
            Assert.That(result, Is.True);
        }

        [Test]
        public void ValidarCampos_ShouldReturnFalse_WhenAnyFieldIsInvalid()
        {
            // Arrange
            var txtDni = form.Controls[&quot;txtDni&quot;] as TextBox;
            txtDni.Text = string.Empty;  // Invalid DNI

            // Act
            var result = (bool)form.GetType().GetMethod(&quot;ValidarCampos&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, null);

            // Assert
            Assert.That(result, Is.False);
        }

        [Test]
        public void RegistrarDonante_ShouldInsertNewDonante()
        {
            // Arrange
            var txtDni = form.Controls[&quot;txtDni&quot;] as TextBox;
            var txtNombre = form.Controls[&quot;txtNombre&quot;] as TextBox;
            var txtApellido = form.Controls[&quot;txtApellido&quot;] as TextBox;
            var cmbTipoDeSangre = form.Controls[&quot;cmbTipoDeSangre&quot;] as ComboBox;
            var cmbRH = form.Controls[&quot;cmbRH&quot;] as ComboBox;
            var txtLitros = form.Controls[&quot;txtLitros&quot;] as TextBox;

            txtDni.Text = &quot;12345678&quot;;
            txtNombre.Text = &quot;Test&quot;;
            txtApellido.Text = &quot;Test&quot;;
            cmbTipoDeSangre.SelectedItem = &quot;A&quot;;
            cmbRH.SelectedItem = &quot;+&quot;;
            txtLitros.Text = &quot;0.5&quot;;

            mockCommand.Setup(c =&gt; c.ExecuteNonQuery()).Verifiable();

            // Act
            form.GetType().GetMethod(&quot;RegistrarDonante&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, null);
        }

        [Test]
        public void ActualizarBancoDeSangre_ShouldUpdateBancoDeSangre()
        {
            // Arrange
            var cmbTipoDeSangre = form.Controls[&quot;cmbTipoDeSangre&quot;] as ComboBox;
            var cmbRH = form.Controls[&quot;cmbRH&quot;] as ComboBox;

            cmbTipoDeSangre.SelectedItem = &quot;A&quot;;
            cmbRH.SelectedItem = &quot;+&quot;;

            mockCommand.Setup(c =&gt; c.ExecuteNonQuery()).Verifiable();

            // Act
            form.GetType().GetMethod(&quot;ActualizarBancoDeSangre&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, null);
        }

        [Test]
        public void ModificarDonante_ShouldUpdateExistingDonante()
        {
            // Arrange
            var txtDni = form.Controls[&quot;txtDni&quot;] as TextBox;
            var txtNombre = form.Controls[&quot;txtNombre&quot;] as TextBox;
            var txtApellido = form.Controls[&quot;txtApellido&quot;] as TextBox;
            var cmbTipoDeSangre = form.Controls[&quot;cmbTipoDeSangre&quot;] as ComboBox;
            var cmbRH = form.Controls[&quot;cmbRH&quot;] as ComboBox;
            var txtLitros = form.Controls[&quot;txtLitros&quot;] as TextBox;

            txtDni.Text = &quot;12345678&quot;;
            txtNombre.Text = &quot;Test&quot;;
            txtApellido.Text = &quot;Test&quot;;
            cmbTipoDeSangre.SelectedItem = &quot;A&quot;;
            cmbRH.SelectedItem = &quot;+&quot;;
            txtLitros.Text = &quot;0.5&quot;;

            mockCommand.Setup(c =&gt; c.ExecuteNonQuery()).Verifiable();

        }


        [Test]
        public void RegistroDonantes_Resize_ShouldResizeControls()
        {
            // Arrange
            var originalSize = form.Size;
            form.Size = new System.Drawing.Size(originalSize.Width + 100, originalSize.Height + 100);

            // Act
            form.GetType().GetMethod(&quot;RegistroDonantes_Resize&quot;, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance)
                .Invoke(form, new object[] { null, EventArgs.Empty });

            // Assert

        }

        [Test]
        public void lblVolver_MouseEnter_ShouldChangeFont()
        {
            // Arrange
            var lblVolver = form.Controls[&quot;lblVolver&quot;] as Label;

            // Obtener el tipo de EventArgs vac&#237;o
            Type[] eventArgsType = new Type[] { typeof(EventArgs) };

        }


        [Test]
        public void lblVolver_MouseLeave_ShouldResetFont()
        {
            // Arrange
            var lblVolver = form.Controls[&quot;lblVolver&quot;] as Label;

        }

        [TearDown]
        public void TearDown()
        {
            // Libera los recursos aqu&#237;
            if (form != null)
            {
                form.Dispose();
                form = null;
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,1],[24,13,24,56,1],[25,13,25,50,1],[26,13,26,50,1],[28,13,28,92,1],[29,13,29,86,1],[31,13,31,43,1],[32,9,32,10,1],[36,9,36,10,1],[38,13,38,45,1],[39,13,39,52,1],[40,13,40,82,1],[41,13,41,59,1],[44,13,45,37,1],[46,9,46,10,1],[50,9,50,10,1],[52,13,52,71,1],[53,13,53,61,1],[54,13,54,67,1],[55,13,55,61,1],[56,13,56,61,1],[57,13,57,60,1],[58,13,58,80,1],[60,13,60,39,1],[61,13,61,38,1],[62,13,62,37,1],[63,13,63,33,1],[64,13,64,33,1],[65,13,65,37,1],[66,13,66,47,1],[69,13,70,37,1],[73,13,74,13,1],[74,13,74,14,1],[74,14,75,17,1],[75,17,75,73,1],[75,73,76,17,1],[76,17,76,68,1],[76,68,77,17,1],[77,17,77,71,1],[77,71,78,17,1],[78,17,78,53,1],[78,53,79,17,1],[79,17,79,53,1],[79,53,80,17,1],[80,17,80,66,1],[80,66,81,17,1],[81,17,81,76,1],[81,76,82,13,1],[82,13,82,14,1],[82,14,82,16,1],[83,9,83,10,1],[87,9,87,10,1],[89,13,89,42,1],[92,13,93,58,1],[96,13,96,42,1],[97,9,97,10,1],[101,9,101,10,1],[103,13,103,43,1],[106,13,107,60,1],[110,13,110,43,1],[111,9,111,10,1],[115,9,115,10,1],[117,13,117,37,1],[118,13,118,66,1],[119,13,119,86,1],[122,13,123,53,1],[124,9,124,10,1],[128,9,128,10,1],[130,13,130,37,1],[131,13,131,66,1],[132,13,132,86,1],[135,13,136,53,1],[137,9,137,10,1],[141,9,141,10,1],[143,13,143,61,1],[144,13,144,67,1],[145,13,145,71,1],[146,13,146,80,1],[147,13,147,60,1],[148,13,148,61,1],[150,13,150,38,1],[151,13,151,37,1],[152,13,152,39,1],[153,13,153,47,1],[154,13,154,37,1],[155,13,155,33,1],[158,13,159,37,1],[162,13,162,42,1],[163,9,163,10,1],[167,9,167,10,1],[169,13,169,61,1],[170,13,170,40,1],[173,13,174,37,1],[177,13,177,43,1],[178,9,178,10,1],[182,9,182,10,1],[184,13,184,61,1],[185,13,185,67,1],[186,13,186,71,1],[187,13,187,80,1],[188,13,188,60,1],[189,13,189,67,1],[191,13,191,38,1],[192,13,192,37,1],[193,13,193,39,1],[194,13,194,48,1],[195,13,195,38,1],[196,13,196,36,1],[198,13,198,70,1],[201,13,202,37,1],[203,9,203,10,1],[207,9,207,10,1],[209,13,209,80,1],[210,13,210,60,1],[212,13,212,48,1],[213,13,213,38,1],[215,13,215,70,1],[218,13,219,37,1],[220,9,220,10,1],[224,9,224,10,1],[226,13,226,61,1],[227,13,227,67,1],[228,13,228,71,1],[229,13,229,80,1],[230,13,230,60,1],[231,13,231,67,1],[233,13,233,38,1],[234,13,234,37,1],[235,13,235,39,1],[236,13,236,48,1],[237,13,237,38,1],[238,13,238,36,1],[240,13,240,70,1],[242,9,242,10,1],[247,9,247,10,1],[249,13,249,42,1],[250,13,250,102,1],[253,13,254,71,1],[258,9,258,10,1],[262,9,262,10,1],[264,13,264,65,1],[267,13,267,69,1],[269,9,269,10,1],[274,9,274,10,1],[276,13,276,65,1],[278,9,278,10,1],[282,9,282,10,1],[284,13,284,30,1],[285,13,285,14,1],[286,17,286,32,1],[287,17,287,29,1],[288,13,288,14,1],[289,9,289,10,1]]);
    </script>
  </body>
</html>