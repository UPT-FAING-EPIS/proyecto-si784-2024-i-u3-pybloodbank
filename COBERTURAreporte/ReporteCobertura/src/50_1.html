<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\UPT Sistemas 7Â°\calidad y pruebas software\Pruebas finales\FINAL\ProyectoU2 Version 9\ProyectoFinal\INFORME.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Data.SqlClient;
namespace Proyecto_Final_Blood_Bank
{
    public partial class INFORME : Form
    {
        public INFORME()
        {
            InitializeComponent();
            this.FormClosed += new System.Windows.Forms.FormClosedEventHandler(this.Form_FormClosed);
            lblVolver.MouseEnter += OnMouseEnter;
            lblVolver.MouseLeave += OnMouseLeave;
        }
        private void Form_FormClosed(object sender, FormClosedEventArgs e)
        {
            Application.Exit();
        }

        public void INFORME_Load(object sender, EventArgs e)
        {
            lblUsuario.Text = LOGIN.NombreUsuario;

            formOriginalSize = this.Size;
            ReclblTitulo = new Rectangle(lblTitulo.Location.X, lblTitulo.Location.Y, lblTitulo.Width, lblTitulo.Height);
            ReclblVolver = new Rectangle(lblVolver.Location.X, lblVolver.Location.Y, lblVolver.Width, lblVolver.Height);
            ReclblUsuario = new Rectangle(lblUsuario.Location.X, lblUsuario.Location.Y, lblUsuario.Width, lblUsuario.Height);
            RecbtnGraph1 = new Rectangle(chartStock.Location.X, chartStock.Location.Y, chartStock.Width, chartStock.Height);
            RecbtnGraph2 = new Rectangle(chartPedido.Location.X, chartPedido.Location.Y, chartPedido.Width, chartPedido.Height);



            SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;);
            con.Open();
            string comando = &quot;Select * from BancoDeSangre&quot;;

            SqlCommand cmd = new SqlCommand(comando, con);
            SqlDataReader dr = cmd.ExecuteReader();


            while (dr.Read())
            {
                string junto = dr[&quot;Tipo&quot;].ToString() + dr[&quot;Rh&quot;].ToString();

                chartStock.Series[&quot;Stock&quot;].IsValueShownAsLabel = true;

                chartStock.Series[&quot;Stock&quot;].Points.AddXY(junto, dr[&quot;Litros&quot;]);

            }
            con.Close();

            SqlConnection con2 = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;);
            SqlConnection con3 = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;);
            con2.Open();
            con3.Open();
            string comando2 = &quot;Select * from Pacientes&quot;;
            string comando3 = &quot;Select * from BancoDeSangre&quot;;
            SqlCommand cmd2 = new SqlCommand(comando2, con2);
            SqlCommand cmd3 = new SqlCommand(comando3, con3);
            SqlDataReader dr2 = cmd2.ExecuteReader();
            SqlDataReader dr3 = cmd3.ExecuteReader();
            Dictionary&lt;string, int&gt; data = new Dictionary&lt;string, int&gt;();
            data[&quot;O+&quot;] = 0;
            data[&quot;O-&quot;] = 0;
            data[&quot;A+&quot;] = 0;
            data[&quot;A-&quot;] = 0;
            data[&quot;B+&quot;] = 0;
            data[&quot;B-&quot;] = 0;
            data[&quot;AB+&quot;] = 0;
            data[&quot;AB-&quot;] = 0;
            while (dr2.Read())
            {
                string junto = dr2[&quot;Tipo&quot;].ToString() + dr2[&quot;Rh&quot;].ToString();

                data[junto]++;

            }

            while (dr3.Read())
            {
                string junto = dr3[&quot;Tipo&quot;].ToString() + dr3[&quot;Rh&quot;].ToString();

                chartPedido.Series[&quot;Solicitada&quot;].IsValueShownAsLabel = true;
                if (data[junto] &gt; 0)
                {
                    chartPedido.Series[&quot;Solicitada&quot;].Points.AddXY(junto, data[junto]);
                }
            }
            con2.Close();
            con3.Close();

        }

        private void lblVolver_Click(object sender, EventArgs e)
        {
            try
            {
                string temp_usuario = lblUsuario.Text;
                string comando = &quot;SELECT estado FROM Personal WHERE Usuario = @usuario&quot;;

                using (SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;))
                {
                    con.Open();

                    // Crear SqlCommand con consulta parametrizada
                    using (SqlCommand cmd = new SqlCommand(comando, con))
                    {
                        // A&#241;adir par&#225;metro para evitar la inyecci&#243;n SQL
                        cmd.Parameters.AddWithValue(&quot;@usuario&quot;, temp_usuario);

                        // Ejecutar consulta y leer resultados
                        SqlDataReader datos = cmd.ExecuteReader();
                        if (datos.Read())
                        {
                            string estado = datos[&quot;estado&quot;].ToString();

                            // Mostrar formularios seg&#250;n el estado del usuario
                            if (estado == &quot;N&quot;)
                            {
                                new OPCIONES_1().Show();
                                this.Hide();
                            }
                            else if (estado == &quot;P&quot;)
                            {
                                new OPCIONES_2().Show();
                                this.Hide();
                            }
                            else if (estado == &quot;A&quot;)
                            {
                                new OPCIONES().Show();
                                this.Hide();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(&quot;Error al obtener el estado del usuario: &quot; + ex.Message, &quot;Error&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
        private Size formOriginalSize;
        // Resolucion Dinamica
        private Rectangle ReclblTitulo;
        private Rectangle ReclblVolver;
        private Rectangle ReclblUsuario;
        private Rectangle RecbtnGraph1;
        private Rectangle RecbtnGraph2;
        public void resizeControl(Rectangle OriginalControlRect, Control control)
        {
            float xRatio = (float)(this.Width) / (float)(formOriginalSize.Width);
            float yRatio = (float)(this.Height) / (float)(formOriginalSize.Height);


            int newX = (int)(OriginalControlRect.X * xRatio);
            int newY = (int)(OriginalControlRect.Y * yRatio);

            int newWidth = (int)(OriginalControlRect.Width * xRatio);
            int newHeight = (int)(OriginalControlRect.Height * yRatio);

            control.Location = new Point(newX, newY);
            control.Size = new Size(newWidth, newHeight);

        }


        private void OnMouseEnter(object sender, EventArgs e)
        {
            lblVolver.Font = new System.Drawing.Font(&quot;Nirmala UI&quot;, 12F, System.Drawing.FontStyle.Bold | System.Drawing.FontStyle.Underline, System.Drawing.GraphicsUnit.Point, 0);
        }

        private void OnMouseLeave(object sender, EventArgs e)
        {
            lblVolver.Font = new System.Drawing.Font(&quot;Nirmala UI&quot;, 9.75F, System.Drawing.FontStyle.Bold | System.Drawing.FontStyle.Underline, System.Drawing.GraphicsUnit.Point, 0);
        }

        public void INFORME_Resize_1(object sender, EventArgs e)
        {
            resizeControl(ReclblUsuario, lblUsuario);
            resizeControl(ReclblVolver, lblVolver);
            resizeControl(ReclblTitulo, lblTitulo);
            resizeControl(RecbtnGraph2, chartPedido);
            resizeControl(RecbtnGraph1, chartStock);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,25,1],[16,9,16,10,1],[17,13,17,35,1],[18,13,18,102,1],[19,13,19,50,1],[20,13,20,50,1],[21,9,21,10,1],[23,9,23,10,1],[24,13,24,32,1],[25,9,25,10,1],[28,9,28,10,1],[29,13,29,51,1],[31,13,31,42,1],[32,13,32,121,1],[33,13,33,121,1],[34,13,34,126,1],[35,13,35,125,1],[36,13,36,129,1],[40,13,40,126,1],[41,13,41,24,1],[42,13,42,60,1],[44,13,44,59,1],[45,13,45,52,1],[48,13,48,30,1],[49,13,49,14,1],[50,17,50,76,1],[52,17,52,71,1],[54,17,54,78,1],[56,13,56,14,1],[57,13,57,25,1],[59,13,59,127,1],[60,13,60,127,1],[61,13,61,25,1],[62,13,62,25,1],[63,13,63,57,1],[64,13,64,61,1],[65,13,65,62,1],[66,13,66,62,1],[67,13,67,54,1],[68,13,68,54,1],[69,13,69,74,1],[70,13,70,28,1],[71,13,71,28,1],[72,13,72,28,1],[73,13,73,28,1],[74,13,74,28,1],[75,13,75,28,1],[76,13,76,29,1],[77,13,77,29,1],[78,13,78,31,1],[79,13,79,14,1],[80,17,80,78,1],[82,17,82,31,1],[84,13,84,14,1],[86,13,86,31,1],[87,13,87,14,1],[88,17,88,78,1],[90,17,90,77,1],[91,17,91,37,1],[92,17,92,18,1],[93,21,93,87,1],[94,17,94,18,1],[95,13,95,14,1],[96,13,96,26,1],[97,13,97,26,1],[99,9,99,10,1],[102,9,102,10,0],[104,13,104,14,0],[105,17,105,55,0],[106,17,106,89,0],[108,24,108,136,0],[109,17,109,18,0],[110,21,110,32,0],[113,28,113,73,0],[114,21,114,22,0],[116,25,116,79,0],[119,25,119,67,0],[120,25,120,42,0],[121,25,121,26,0],[122,29,122,72,0],[125,29,125,47,0],[126,29,126,30,0],[127,33,127,57,0],[128,33,128,45,0],[129,29,129,30,0],[130,34,130,52,0],[131,29,131,30,0],[132,33,132,57,0],[133,33,133,45,0],[134,29,134,30,0],[135,34,135,52,0],[136,29,136,30,0],[137,33,137,55,0],[138,33,138,45,0],[139,29,139,30,0],[140,25,140,26,0],[141,21,141,22,0],[142,17,142,18,0],[143,13,143,14,0],[144,13,144,33,0],[145,13,145,14,0],[146,17,146,143,0],[147,13,147,14,0],[148,9,148,10,0],[157,9,157,10,1],[158,13,158,82,1],[159,13,159,84,1],[162,13,162,62,1],[163,13,163,62,1],[165,13,165,70,1],[166,13,166,72,1],[168,13,168,54,1],[169,13,169,58,1],[171,9,171,10,1],[175,9,175,10,0],[176,13,176,179,0],[177,9,177,10,0],[180,9,180,10,0],[181,13,181,181,0],[182,9,182,10,0],[185,9,185,10,1],[186,13,186,54,1],[187,13,187,52,1],[188,13,188,52,1],[189,13,189,54,1],[190,13,190,53,1],[191,9,191,10,1]]);
    </script>
  </body>
</html>