<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\UPT Sistemas 7Â°\calidad y pruebas software\Pruebas finales\FINAL\ProyectoU2 Version 9\ProyectoFinal\TestIniciodeSesion.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;
using System.Linq;
using System.Text;
using NUnit.Framework;
using Moq;
using System.Threading.Tasks;
using System.Windows.Forms;
using Proyecto_Final_Blood_Bank;

namespace Proyecto_Final_Blood_Bank
{
    [TestFixture]
    public class TestIniciodeSesion
    {
        private Mock&lt;IDbConnection&gt; mockConnection;
        private Mock&lt;IDbCommand&gt; mockCommand;
        private Mock&lt;IDataReader&gt; mockReader;
        private LOGIN loginForm;

        [SetUp]
        public void Setup()
        {
            mockConnection = new Mock&lt;IDbConnection&gt;();
            mockCommand = new Mock&lt;IDbCommand&gt;();
            mockReader = new Mock&lt;IDataReader&gt;();

            mockConnection.Setup(conn =&gt; conn.CreateCommand()).Returns(mockCommand.Object);
            mockCommand.Setup(cmd =&gt; cmd.ExecuteReader()).Returns(mockReader.Object);

            loginForm = new LOGIN(mockConnection.Object);
        }

        [Test]
        public void btnLogin_Click_AttemptLogin_Fails()
        {
            // Arrange
            var usernameTextBox = new TextBox { Text = &quot;InvalidUser!&quot; };
            var passwordTextBox = new TextBox { Text = &quot;Password123&quot; };
            SetPrivateField(loginForm, &quot;txtUsername&quot;, usernameTextBox);
            SetPrivateField(loginForm, &quot;txtPassword&quot;, passwordTextBox);

            // Act
            loginForm.btnLogin_Click(null, EventArgs.Empty);

            // Assert
            Assert.That(loginForm.AttemptLogin(), Is.False);
        }


        [Test]
        public void btnLogin_Click_AttemptLogin_Succeeds()
        {
            // Arrange
            var usernameTextBox = new TextBox { Text = &quot;ValidUser&quot; };
            var passwordTextBox = new TextBox { Text = &quot;Password123&quot; };
            SetPrivateField(loginForm, &quot;txtUsername&quot;, usernameTextBox);
            SetPrivateField(loginForm, &quot;txtPassword&quot;, passwordTextBox);

            // Act
            loginForm.btnLogin_Click(null, EventArgs.Empty);

            // Assert
            Assert.That(loginForm.AttemptLogin(), Is.False);
        }

        [Test]
        public void AttemptLogin_ValidUser()
        {
            // Arrange
            var usernameTextBox = new TextBox { Text = &quot;ValidUser&quot; };
            SetPrivateField(loginForm, &quot;txtUsername&quot;, usernameTextBox);

            // Act
            var result = loginForm.AttemptLogin();

            // Assert
            Assert.That(result, Is.False);
        }

        [Test]
        public void AttemptLogin_InvalidUser()
        {
            // Arrange
            var usernameTextBox = new TextBox { Text = &quot;InvalidUser!&quot; };
            SetPrivateField(loginForm, &quot;txtUsername&quot;, usernameTextBox);

            // Act
            var result = loginForm.AttemptLogin();

            // Assert
            Assert.That(result, Is.False);
        }

        [Test]
        public void CheckCredentials_ValidCredentials()
        {
            // Arrange
            // Configuraci&#243;n inicial de los mocks y datos de entrada
            var username = &quot;ValidUser&quot;;
            var password = &quot;Password123&quot;;

            var usernameTextBox = new TextBox { Text = username };
            var passwordTextBox = new TextBox { Text = password };

            SetPrivateField(loginForm, &quot;txtUsername&quot;, usernameTextBox);
            SetPrivateField(loginForm, &quot;txtPassword&quot;, passwordTextBox);

            // Simular el comportamiento del lector y del comando
            mockReader.SetupSequence(r =&gt; r.Read())
                      .Returns(true) // Primera llamada a Read() devuelve true
                      .Returns(false); // Siguientes llamadas devuelven false

            mockReader.Setup(r =&gt; r[&quot;estado&quot;]).Returns(&quot;N&quot;);

            mockCommand.Setup(cmd =&gt; cmd.ExecuteReader()).Returns(mockReader.Object);
            mockConnection.Setup(conn =&gt; conn.CreateCommand()).Returns(mockCommand.Object);

            // Act
            loginForm.CheckCredentials();
        }


        [Test]
        public void CheckCredentials_InvalidCredentials()
        {
            // Arrange
            var usernameTextBox = new TextBox { Text = &quot;ValidUser&quot; };
            var passwordTextBox = new TextBox { Text = &quot;Password123&quot; };
            SetPrivateField(loginForm, &quot;txtUsername&quot;, usernameTextBox);
            SetPrivateField(loginForm, &quot;txtPassword&quot;, passwordTextBox);

            mockReader.Setup(r =&gt; r.Read()).Returns(false);

            // Act
            loginForm.CheckCredentials();
        }

        [Test]
        public void HandleSuccessfulLogin_ShowsCorrectForm()
        {
            // Arrange
            var estado = &quot;N&quot;;

            // Act
            loginForm.HandleSuccessfulLogin(estado);

            // Assert
            // Add assertions to verify the correct form is shown
        }

        [Test]
        public void HandleFailedLogin_ShowsErrorMessage()
        {
            // Arrange
            var usernameTextBox = new TextBox { Text = &quot;ValidUser&quot; };
            var passwordTextBox = new TextBox { Text = &quot;Password123&quot; };
            SetPrivateField(loginForm, &quot;txtUsername&quot;, usernameTextBox);
            SetPrivateField(loginForm, &quot;txtPassword&quot;, passwordTextBox);

            // Act
            loginForm.HandleFailedLogin();
        }


        [TearDown]
        public void TearDown()
        {
            // Libera los recursos aqu&#237;
            if (loginForm != null)
            {
                loginForm.Dispose();
                loginForm = null;
            }
        }

        private void SetPrivateField(object obj, string fieldName, object value)
        {
            var field = obj.GetType().GetField(fieldName, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance);
            if (field != null)
            {
                field.SetValue(obj, value);
            }
        }
    }

}

    </pre>
    <script type="text/javascript">
      highlightRanges([[23,9,23,10,1],[24,13,24,56,1],[25,13,25,50,1],[26,13,26,50,1],[28,13,28,92,1],[29,13,29,86,1],[31,13,31,58,1],[32,9,32,10,1],[36,9,36,10,1],[38,13,38,73,1],[39,13,39,72,1],[40,13,40,72,1],[41,13,41,72,1],[44,13,44,61,1],[47,13,47,61,1],[48,9,48,10,1],[53,9,53,10,1],[55,13,55,70,1],[56,13,56,72,1],[57,13,57,72,1],[58,13,58,72,1],[61,13,61,61,1],[64,13,64,61,1],[65,9,65,10,1],[69,9,69,10,1],[71,13,71,70,1],[72,13,72,72,1],[75,13,75,51,1],[78,13,78,43,1],[79,9,79,10,1],[83,9,83,10,1],[85,13,85,73,1],[86,13,86,72,1],[89,13,89,51,1],[92,13,92,43,1],[93,9,93,10,1],[97,9,97,10,1],[100,13,100,40,1],[101,13,101,42,1],[103,13,103,67,1],[104,13,104,67,1],[106,13,106,72,1],[107,13,107,72,1],[110,13,112,39,1],[114,13,114,61,1],[116,13,116,86,1],[117,13,117,92,1],[120,13,120,42,1],[121,9,121,10,1],[126,9,126,10,1],[128,13,128,70,1],[129,13,129,72,1],[130,13,130,72,1],[131,13,131,72,1],[133,13,133,60,1],[136,13,136,42,1],[137,9,137,10,1],[141,9,141,10,1],[143,13,143,30,1],[146,13,146,53,1],[150,9,150,10,1],[154,9,154,10,1],[156,13,156,70,1],[157,13,157,72,1],[158,13,158,72,1],[159,13,159,72,1],[162,13,162,43,1],[163,9,163,10,1],[168,9,168,10,1],[170,13,170,35,1],[171,13,171,14,1],[172,17,172,37,1],[173,17,173,34,1],[174,13,174,14,1],[175,9,175,10,1],[178,9,178,10,1],[179,13,179,143,1],[180,13,180,31,1],[181,13,181,14,1],[182,17,182,44,1],[183,13,183,14,1],[184,9,184,10,1]]);
    </script>
  </body>
</html>