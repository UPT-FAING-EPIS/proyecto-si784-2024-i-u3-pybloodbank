<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\UPT Sistemas 7Â°\calidad y pruebas software\Pruebas finales\FINAL\ProyectoU2 Version 9\ProyectoFinal\PERSONAL.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Data.SqlClient;
namespace Proyecto_Final_Blood_Bank
{
	public partial class PERSONAL : Form
	{
		public PERSONAL()
		{
			InitializeComponent();

			lblVolver.MouseEnter += OnMouseEnter;
			lblVolver.MouseLeave += OnMouseLeave;
			this.FormClosed += new System.Windows.Forms.FormClosedEventHandler(this.Form_FormClosed);
		}
		private void Form_FormClosed(object sender, FormClosedEventArgs e)
		{
			Application.Exit();
		}

		public void CargarGrilla()
		{
			SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;);
			string consulta = &quot;Select Usuario,estado from Personal&quot;;
			SqlDataAdapter adaptador = new SqlDataAdapter(consulta, con);
			DataTable dt = new DataTable();
			adaptador.Fill(dt);
			dgvPersonal.DataSource = dt;
			dgvPersonal.Columns[1].Width = 45;

		}


		public void label3_Click(object sender, EventArgs e)
		{
			string temp_usuario = lblUsuario.Text;
			string comando = &quot;SELECT estado FROM Personal WHERE Usuario = @usuario&quot;;

			// Establecer la conexi&#243;n a la base de datos
			using (SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;))
			{
				con.Open();

				// Crear el comando SQL parametrizado
				using (SqlCommand cmd = new SqlCommand(comando, con))
				{
					cmd.Parameters.AddWithValue(&quot;@usuario&quot;, temp_usuario);

					// Ejecutar la consulta
					using (SqlDataReader datos = cmd.ExecuteReader())
					{
						if (datos.Read())
						{
							string estado = datos[&quot;estado&quot;].ToString();

							// Mostrar las opciones seg&#250;n el estado obtenido
							if (estado == &quot;N&quot;)
							{
								new OPCIONES_1().Show();
								this.Hide();
							}
							else if (estado == &quot;P&quot;)
							{
								new OPCIONES_2().Show();
								this.Hide();
							}
							else if (estado == &quot;A&quot;)
							{
								new OPCIONES().Show();
								this.Hide();
							}
						}
					}
				}
			}
		}

		private void OnMouseEnter(object sender, EventArgs e)
		{
            lblVolver.Font = new System.Drawing.Font(&quot;Nirmala UI&quot;, 12F, System.Drawing.FontStyle.Bold | System.Drawing.FontStyle.Underline, System.Drawing.GraphicsUnit.Point, 0);
        }

		private void OnMouseLeave(object sender, EventArgs e)
		{
            lblVolver.Font = new System.Drawing.Font(&quot;Nirmala UI&quot;, 9.75F, System.Drawing.FontStyle.Bold | System.Drawing.FontStyle.Underline, System.Drawing.GraphicsUnit.Point, 0);
        }

		private void dgvPersonal_CellContentClick(object sender, DataGridViewCellEventArgs e)
		{
			txtUsuario.Text = Convert.ToString(dgvPersonal.CurrentRow.Cells[&quot;Usuario&quot;].Value);
			string estatus = Convert.ToString(dgvPersonal.CurrentRow.Cells[&quot;estado&quot;].Value);


			if (estatus.Equals(&quot;P&quot;))
			{

				cmbEstado.SelectedIndex = 1;

			}
			else if (estatus.Equals(&quot;A&quot;))
			{
				cmbEstado.SelectedIndex = 0;


			}
			else
			{
				cmbEstado.SelectedIndex = 2;
			}
		}


		public void button1_Click(object sender, EventArgs e)
		{
			try
			{
				string temp_usuario = txtUsuario.Text;
				string comando = &quot;UPDATE Personal SET estado=&#39;P&#39; WHERE Usuario = @usuario&quot;;

				// Establecer la conexi&#243;n a la base de datos
				using (SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;))
				{
					con.Open();

					// Crear el comando SQL parametrizado
					using (SqlCommand cmd = new SqlCommand(comando, con))
					{
						cmd.Parameters.AddWithValue(&quot;@usuario&quot;, temp_usuario);

						// Ejecutar la consulta
						cmd.ExecuteNonQuery();

						MessageBox.Show(&quot;Se ha ascendido con &#233;xito.&quot;, &quot;Banco de Sangre&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);
					}
				}

				// Actualizar la grilla despu&#233;s de modificar
				CargarGrilla();
			}
			catch (Exception ex)
			{
				MessageBox.Show(&quot;Error al modificar el registro: &quot; + ex.Message, &quot;Banco de Sangre&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
		}

		public void btnBajar_Click(object sender, EventArgs e)
		{
			try
			{
				string temp_usuario = txtUsuario.Text;
				string comando = &quot;UPDATE Personal SET estado=&#39;N&#39; WHERE Usuario = @usuario&quot;;

				// Establecer la conexi&#243;n a la base de datos
				using (SqlConnection con = new SqlConnection(&quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;))
				{
					con.Open();

					// Crear el comando SQL parametrizado
					using (SqlCommand cmd = new SqlCommand(comando, con))
					{
						cmd.Parameters.AddWithValue(&quot;@usuario&quot;, temp_usuario);

						// Ejecutar la consulta
						cmd.ExecuteNonQuery();

						MessageBox.Show(&quot;Se ha bajado el rango con &#233;xito.&quot;, &quot;Banco de Sangre&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);
					}
				}

				// Actualizar la grilla despu&#233;s de modificar
				CargarGrilla();
			}
			catch (Exception ex)
			{
				MessageBox.Show(&quot;Error al modificar el registro: &quot; + ex.Message, &quot;Banco de Sangre&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);
			}
		}

		private Rectangle RecTitulo;
		private Rectangle RecVolver;
		private Rectangle ReclblUsuario;
		private Rectangle ReclblUsuario2;
		private Rectangle RectxtUsuario;
		private Rectangle RecbtnSubir;
		private Rectangle ReclblEstado;
		private Rectangle ReccmbEstado;
		private Rectangle RecBtnBajar;
		private Rectangle RecdgvPersonal;

		private Size formOriginalSize;

		internal void PERSONAL_Load(object sender, EventArgs e)
		{
			lblUsuario.Text = LOGIN.NombreUsuario;
			CargarGrilla();


			formOriginalSize = this.Size;
			RecTitulo = new Rectangle(lblTitulo.Location.X, lblTitulo.Location.Y, lblTitulo.Width, lblTitulo.Height);
			RecVolver = new Rectangle(lblVolver.Location.X, lblVolver.Location.Y, lblVolver.Width, lblVolver.Height);
			ReclblUsuario = new Rectangle(lblUsuario.Location.X, lblUsuario.Location.Y, lblUsuario.Width, lblUsuario.Height);
			ReclblUsuario2 = new Rectangle(lblUsuario2.Location.X, lblUsuario2.Location.Y, lblUsuario2.Width, lblUsuario2.Height);
			RectxtUsuario = new Rectangle(txtUsuario.Location.X, txtUsuario.Location.Y, txtUsuario.Width, txtUsuario.Height);
			RecbtnSubir = new Rectangle(btnSubir.Location.X, btnSubir.Location.Y, btnSubir.Width, btnSubir.Height);
			ReclblEstado = new Rectangle(lblEstado.Location.X, lblEstado.Location.Y, lblEstado.Width, lblEstado.Height);
			ReccmbEstado = new Rectangle(cmbEstado.Location.X, cmbEstado.Location.Y, cmbEstado.Width, cmbEstado.Height);

			RecBtnBajar = new Rectangle(btnBajar.Location.X, btnBajar.Location.Y, btnBajar.Width, btnBajar.Height);
			RecdgvPersonal = new Rectangle(dgvPersonal.Location.X, dgvPersonal.Location.Y, dgvPersonal.Width, dgvPersonal.Height);
		}

		private void resizeControl(Rectangle OriginalControlRect, Control control)
		{
			float xRatio = (float)(this.Width) / (float)(formOriginalSize.Width);
			float yRatio = (float)(this.Height) / (float)(formOriginalSize.Height);


			int newX = (int)(OriginalControlRect.X * xRatio);
			int newY = (int)(OriginalControlRect.Y * yRatio);

			int newWidth = (int)(OriginalControlRect.Width * xRatio);
			int newHeight = (int)(OriginalControlRect.Height * yRatio);

			control.Location = new Point(newX, newY);
			control.Size = new Size(newWidth, newHeight);

		}

		private void PERSONAL_Resize(object sender, EventArgs e)
		{
			resizeControl(RecTitulo, lblTitulo);
			resizeControl(RecVolver, lblVolver);
			resizeControl(ReclblUsuario, lblUsuario);
			resizeControl(ReclblUsuario2, lblUsuario2);
			resizeControl(RectxtUsuario, txtUsuario);
			resizeControl(RecbtnSubir, btnSubir);
			resizeControl(ReclblEstado, lblEstado);
			resizeControl(ReccmbEstado, cmbEstado);
			resizeControl(RecBtnBajar, btnBajar);
			resizeControl(RecdgvPersonal, dgvPersonal);
		}
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[15,3,15,20,1],[16,3,16,4,1],[17,4,17,26,1],[19,4,19,41,1],[20,4,20,41,1],[21,4,21,93,1],[22,3,22,4,1],[24,3,24,4,1],[25,4,25,23,1],[26,3,26,4,1],[29,3,29,4,1],[30,4,30,117,1],[31,4,31,60,1],[32,4,32,65,1],[33,4,33,35,1],[34,4,34,23,1],[35,4,35,32,1],[36,4,36,38,1],[38,3,38,4,1],[42,3,42,4,1],[43,4,43,42,1],[44,4,44,76,1],[47,11,47,123,1],[48,4,48,5,1],[49,5,49,16,1],[52,12,52,57,1],[53,5,53,6,1],[54,6,54,60,1],[57,13,57,54,1],[58,6,58,7,1],[59,7,59,24,1],[60,7,60,8,0],[61,8,61,51,0],[64,8,64,26,0],[65,8,65,9,0],[66,9,66,33,0],[67,9,67,21,0],[68,8,68,9,0],[69,13,69,31,0],[70,8,70,9,0],[71,9,71,33,0],[72,9,72,21,0],[73,8,73,9,0],[74,13,74,31,0],[75,8,75,9,0],[76,9,76,31,0],[77,9,77,21,0],[78,8,78,9,0],[79,7,79,8,0],[80,6,80,7,1],[81,5,81,6,1],[82,4,82,5,1],[83,3,83,4,1],[86,3,86,4,0],[87,13,87,179,0],[88,9,88,10,0],[91,3,91,4,0],[92,13,92,181,0],[93,9,93,10,0],[96,3,96,4,0],[97,4,97,86,0],[98,4,98,84,0],[101,4,101,28,0],[102,4,102,5,0],[104,5,104,33,0],[106,4,106,5,0],[107,9,107,33,0],[108,4,108,5,0],[109,5,109,33,0],[112,4,112,5,0],[114,4,114,5,0],[115,5,115,33,0],[116,4,116,5,0],[117,3,117,4,0],[121,3,121,4,1],[123,4,123,5,1],[124,5,124,43,1],[125,5,125,80,1],[128,12,128,124,1],[129,5,129,6,1],[130,6,130,17,1],[133,13,133,58,1],[134,6,134,7,1],[135,7,135,61,1],[138,7,138,29,1],[140,7,140,122,1],[141,6,141,7,1],[142,5,142,6,1],[145,5,145,20,1],[146,4,146,5,1],[147,4,147,24,0],[148,4,148,5,0],[149,5,149,133,0],[150,4,150,5,0],[151,3,151,4,1],[154,3,154,4,1],[156,4,156,5,1],[157,5,157,43,1],[158,5,158,80,1],[161,12,161,124,1],[162,5,162,6,1],[163,6,163,17,1],[166,13,166,58,1],[167,6,167,7,1],[168,7,168,61,1],[171,7,171,29,1],[173,7,173,128,1],[174,6,174,7,1],[175,5,175,6,1],[178,5,178,20,1],[179,4,179,5,1],[180,4,180,24,0],[181,4,181,5,0],[182,5,182,133,0],[183,4,183,5,0],[184,3,184,4,1],[200,3,200,4,1],[201,4,201,42,1],[202,4,202,19,1],[205,4,205,33,1],[206,4,206,109,1],[207,4,207,109,1],[208,4,208,117,1],[209,4,209,122,1],[210,4,210,117,1],[211,4,211,107,1],[212,4,212,112,1],[213,4,213,112,1],[215,4,215,107,1],[216,4,216,122,1],[217,3,217,4,1],[220,3,220,4,0],[221,4,221,73,0],[222,4,222,75,0],[225,4,225,53,0],[226,4,226,53,0],[228,4,228,61,0],[229,4,229,63,0],[231,4,231,45,0],[232,4,232,49,0],[234,3,234,4,0],[237,3,237,4,0],[238,4,238,40,0],[239,4,239,40,0],[240,4,240,45,0],[241,4,241,47,0],[242,4,242,45,0],[243,4,243,41,0],[244,4,244,43,0],[245,4,245,43,0],[246,4,246,41,0],[247,4,247,47,0],[248,3,248,4,0]]);
    </script>
  </body>
</html>