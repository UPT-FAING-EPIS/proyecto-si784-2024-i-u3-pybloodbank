<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\UPT Sistemas 7Â°\calidad y pruebas software\Pruebas finales\FINAL\ProyectoU2 Version 9\ProyectoFinal\TestRegistroPaciente.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using NUnit.Framework;
using System;
using System.Data;
using System.Data.SqlClient;
using Proyecto_Final_Blood_Bank;
using System.Windows.Forms;
using System.Drawing;
using System.Reflection;

namespace ProyectoFinalBloodBankTests
{
    [TestFixture]
    internal class RegistroPacienteTests
    {
        private const string ConnectionString = &quot;Data Source=localhost;Initial Catalog=Hospital;Integrated Security=True&quot;;
        private const string V = &quot;123456789&quot;;
        private REGISTRO_PACIENTE form;

        [SetUp]
        public void SetUp()
        {
            // Configurar el formulario y el contexto de la prueba
            form = new REGISTRO_PACIENTE();

            // Acceder al campo lblVolver usando reflexi&#243;n
            var fieldInfo = typeof(REGISTRO_PACIENTE).GetField(&quot;lblVolver&quot;, BindingFlags.NonPublic | BindingFlags.Instance);
            var lblVolver = (Label)fieldInfo.GetValue(form);
            lblVolver.Font = new Font(&quot;Nirmala UI&quot;, 12F, FontStyle.Bold | FontStyle.Underline);

            form.Show(); // Mostrar el formulario para pruebas
        }

        [Test]
        public void TestBtnRegistrarClick()
        {
            // Simulaci&#243;n de datos de entrada utilizando las propiedades p&#250;blicas
            form.TxtDni.Text = &quot;12345678&quot;;
            form.TxtNombre.Text = &quot;Juan&quot;;
            form.TxtApellido.Text = &quot;Perez&quot;;
            form.TxtDireccion.Text = &quot;Calle Falsa 123&quot;;
            form.TxtTelefono.Text = V;
            form.CmbTipoDeSangre.SelectedIndex = 0; // Ejemplo: &quot;A&quot;
            form.CmbRH.SelectedIndex = 0; // Ejemplo: &quot;+&quot;

            try
            {
                // Ejecutar el evento click del bot&#243;n Registrar
                form.btnregistrar_Click(null, EventArgs.Empty);

                // Verificar si se ha insertado correctamente en la base de datos
                string selectQuery = &quot;SELECT COUNT(*) FROM Pacientes WHERE dni = @dni&quot;;
                int count = 0;

                using (var con = new SqlConnection(ConnectionString))
                {
                    con.Open();
                    using (var cmdSelect = new SqlCommand(selectQuery, con))
                    {
                        cmdSelect.Parameters.AddWithValue(&quot;@dni&quot;, form.TxtDni.Text.Trim());
                        count = (int)cmdSelect.ExecuteScalar();
                    }
                }
            }
            finally
            {
                // Cerrar el formulario al finalizar las pruebas
                form.Close();
            }
        }

        [Test]
        public void TestBtnEliminarClick()
        {
            // Simulaci&#243;n de datos de entrada utilizando las propiedades p&#250;blicas
            form.TxtDni.Text = &quot;12345678&quot;; // Suponemos que este DNI existe en la base de datos para poder eliminarlo

            try
            {
                // Ejecutar el evento click del bot&#243;n Eliminar
                form.btnEliminar_Click(null, EventArgs.Empty);

                // Verificar si se ha eliminado correctamente en la base de datos
                string selectQuery = &quot;SELECT COUNT(*) FROM Pacientes WHERE dni = @dni&quot;;
                int count = 0;

                using (var con = new SqlConnection(ConnectionString))
                {
                    con.Open();
                    using (var cmdSelect = new SqlCommand(selectQuery, con))
                    {
                        cmdSelect.Parameters.AddWithValue(&quot;@dni&quot;, form.TxtDni.Text.Trim());
                        count = (int)cmdSelect.ExecuteScalar();
                    }
                }

                // Verificar que no existan registros con el DNI especificado
                Assert.That(count, Is.EqualTo(0));
            }
            finally
            {
                // Cerrar el formulario al finalizar las pruebas
                form.Close();
            }
        }

        [Test]
        public void TestBtnModificarClick()
        {
            // Simulaci&#243;n de datos de entrada utilizando las propiedades p&#250;blicas
            form.TxtDni.Text = &quot;12345678&quot;; // Suponemos que este DNI existe en la base de datos para poder modificarlo
            form.TxtNombre.Text = &quot;NuevoNombre&quot;;
            form.TxtApellido.Text = &quot;NuevoApellido&quot;;
            form.TxtDireccion.Text = &quot;NuevaDireccion&quot;;
            form.TxtTelefono.Text = &quot;987654321&quot;;
            form.CmbTipoDeSangre.SelectedIndex = 1; // Ejemplo: &quot;B&quot;
            form.CmbRH.SelectedIndex = 1; // Ejemplo: &quot;-&quot;

            try
            {
                // Obtener el estado actual del registro antes de modificarlo
                string selectQueryBefore = &quot;SELECT COUNT(*) FROM Pacientes WHERE dni = @dni&quot;;
                int countBefore = 0;

                using (var conBefore = new SqlConnection(ConnectionString))
                {
                    conBefore.Open();
                    using (var cmdSelectBefore = new SqlCommand(selectQueryBefore, conBefore))
                    {
                        cmdSelectBefore.Parameters.AddWithValue(&quot;@dni&quot;, form.TxtDni.Text.Trim());

                        countBefore = (int)cmdSelectBefore.ExecuteScalar();
                    }
                }

                // Ejecutar el evento click del bot&#243;n Modificar
                form.btnModificar_Click(null, EventArgs.Empty);

                // Obtener el estado despu&#233;s de modificar el registro
                int countAfter = 0;

                using (var conAfter = new SqlConnection(ConnectionString))
                {
                    conAfter.Open();
                    using (var cmdSelectAfter = new SqlCommand(selectQueryBefore, conAfter))
                    {
                        cmdSelectAfter.Parameters.AddWithValue(&quot;@dni&quot;, form.TxtDni.Text.Trim());

                        countAfter = (int)cmdSelectAfter.ExecuteScalar();
                    }
                }
            }
            finally
            {
                // Cerrar el formulario al finalizar las pruebas
                form.Close();
            }
        }


        [Test]
        public void TestBtnLimpiarClick()
        {
            // Ejecutar el evento click del bot&#243;n Limpiar
            form.btnlimpiar_Click(null, EventArgs.Empty);

            // Verificar que todos los campos est&#233;n limpios despu&#233;s de hacer clic en Limpiar
            Assert.That(form.TxtDni.Text, Is.EqualTo(&quot;&quot;));
            Assert.That(form.TxtNombre.Text, Is.EqualTo(&quot;&quot;));
            Assert.That(form.TxtApellido.Text, Is.EqualTo(&quot;&quot;));
            Assert.That(form.TxtDireccion.Text, Is.EqualTo(&quot;&quot;));
            Assert.That(form.TxtTelefono.Text, Is.EqualTo(&quot;&quot;));
            Assert.That(form.CmbTipoDeSangre.SelectedIndex, Is.EqualTo(-1));
            Assert.That(form.CmbRH.SelectedIndex, Is.EqualTo(-1));
        }

        [Test]
        public void TestHoraTick()
        {
            // Simular el evento Tick del temporizador de hora
            form.Hora_Tick(null, EventArgs.Empty);

            // Verificar que el campo txtFechayHora contenga una fecha y hora v&#225;lida
            DateTime resultDateTime;
            Assert.That(DateTime.TryParseExact(form.TxtFechayHora.Text, &quot;dd/MM/yy HH:mm:ss&quot;, null, System.Globalization.DateTimeStyles.None, out resultDateTime), Is.True);
        }


        [Test]
        public void TestLabel3Click()
        {
            // Simular el evento Click del label lblUsuario
            form.label3_Click(null, EventArgs.Empty);

            // Aqu&#237; puedes agregar aserciones para verificar el comportamiento esperado al hacer clic en lblUsuario
            // Dependiendo de la l&#243;gica dentro del m&#233;todo label3_Click
        }

        [Test]
        public void TestOnMouseEnter()
        {
            // Simulate the MouseEnter event of lblVolver
            form.OnMouseEnter(null, EventArgs.Empty);

            // Verify that the font name, size, and style match the expected values
            var fieldInfo = typeof(REGISTRO_PACIENTE).GetField(&quot;lblVolver&quot;, BindingFlags.NonPublic | BindingFlags.Instance);
            var lblVolver = (Label)fieldInfo.GetValue(form);

            Assert.That(lblVolver.Font.Name, Is.EqualTo(&quot;Nirmala UI&quot;));
            Assert.That(lblVolver.Font.Size, Is.EqualTo(12F));
            Assert.That(lblVolver.Font.Style, Is.EqualTo(FontStyle.Bold | FontStyle.Underline));
        }


        [Test]
        public void TestOnMouseLeave()
        {
            // Simulate the MouseLeave event of lblVolver
            form.OnMouseLeave(null, EventArgs.Empty);

            // Verify that the font name, size, and style match the expected values
            var fieldInfo = typeof(REGISTRO_PACIENTE).GetField(&quot;lblVolver&quot;, BindingFlags.NonPublic | BindingFlags.Instance);
            var lblVolver = (Label)fieldInfo.GetValue(form);

            Assert.That(lblVolver.Font.Name, Is.EqualTo(&quot;Nirmala UI&quot;));
            Assert.That(lblVolver.Font.Size, Is.EqualTo(9.75F));
            Assert.That(lblVolver.Font.Style, Is.EqualTo(FontStyle.Bold | FontStyle.Underline));
        }



        [Test]
        public void TestDgvregistrosCellContentClick()
        {
            // Simular el evento CellContentClick de dgvPacientes
            form.dgvregistros_CellContentClick(null, new DataGridViewCellEventArgs(0, 0));

            // Aqu&#237; puedes agregar aserciones para verificar que los datos seleccionados se carguen correctamente en los controles del formulario
            // Dependiendo de la l&#243;gica dentro del m&#233;todo dgvregistros_CellContentClick
        }



        [TearDown]
        public void TearDown()
        {
            // Cerrar el formulario al finalizar las pruebas si no se ha cerrado
            if (form != null &amp;&amp; !form.IsDisposed)
            {
                form.Close();
            }
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,9,21,10,1],[23,13,23,44,1],[26,13,26,125,1],[27,13,27,61,1],[28,13,28,96,1],[30,13,30,25,1],[31,9,31,10,1],[35,9,35,10,1],[37,13,37,43,1],[38,13,38,42,1],[39,13,39,45,1],[40,13,40,56,1],[41,13,41,39,1],[42,13,42,52,1],[43,13,43,42,1],[46,13,46,14,1],[48,17,48,64,1],[51,17,51,88,1],[52,17,52,31,1],[54,24,54,69,1],[55,17,55,18,1],[56,21,56,32,1],[57,28,57,76,1],[58,21,58,22,1],[59,25,59,92,1],[60,25,60,64,1],[61,21,61,22,1],[62,17,62,18,1],[63,13,63,14,1],[65,13,65,14,1],[67,17,67,30,1],[68,13,68,14,1],[69,9,69,10,1],[73,9,73,10,1],[75,13,75,43,1],[78,13,78,14,1],[80,17,80,63,1],[83,17,83,88,1],[84,17,84,31,1],[86,24,86,69,1],[87,17,87,18,1],[88,21,88,32,1],[89,28,89,76,1],[90,21,90,22,1],[91,25,91,92,1],[92,25,92,64,1],[93,21,93,22,1],[94,17,94,18,1],[97,17,97,51,1],[98,13,98,14,1],[100,13,100,14,1],[102,17,102,30,1],[103,13,103,14,1],[104,9,104,10,1],[108,9,108,10,1],[110,13,110,43,1],[111,13,111,49,1],[112,13,112,53,1],[113,13,113,55,1],[114,13,114,49,1],[115,13,115,52,1],[116,13,116,42,1],[119,13,119,14,1],[121,17,121,94,1],[122,17,122,37,1],[124,24,124,75,1],[125,17,125,18,1],[126,21,126,38,1],[127,28,127,94,1],[128,21,128,22,1],[129,25,129,98,1],[131,25,131,76,1],[132,21,132,22,1],[133,17,133,18,1],[136,17,136,64,1],[139,17,139,36,1],[141,24,141,74,1],[142,17,142,18,1],[143,21,143,37,1],[144,28,144,92,1],[145,21,145,22,1],[146,25,146,97,1],[148,25,148,74,1],[149,21,149,22,1],[150,17,150,18,1],[151,13,151,14,1],[153,13,153,14,1],[155,17,155,30,1],[156,13,156,14,1],[157,9,157,10,1],[162,9,162,10,1],[164,13,164,58,1],[167,13,167,59,1],[168,13,168,62,1],[169,13,169,64,1],[170,13,170,65,1],[171,13,171,64,1],[172,13,172,77,1],[173,13,173,67,1],[174,9,174,10,1],[178,9,178,10,1],[180,13,180,51,1],[184,13,184,172,1],[185,9,185,10,1],[190,9,190,10,1],[192,13,192,54,1],[196,9,196,10,1],[200,9,200,10,1],[202,13,202,54,1],[205,13,205,125,1],[206,13,206,61,1],[208,13,208,72,1],[209,13,209,63,1],[210,13,210,97,1],[211,9,211,10,1],[216,9,216,10,1],[218,13,218,54,1],[221,13,221,125,1],[222,13,222,61,1],[224,13,224,72,1],[225,13,225,65,1],[226,13,226,97,1],[227,9,227,10,1],[233,9,233,10,1],[235,13,235,91,1],[239,9,239,10,1],[245,9,245,10,1],[247,13,247,50,1],[248,13,248,14,1],[249,17,249,30,1],[250,13,250,14,1],[251,9,251,10,1]]);
    </script>
  </body>
</html>